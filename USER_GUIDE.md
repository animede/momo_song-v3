# 🎵 Momo Song v3 ユーザーガイド

## 📋 目次
1. [アプリケーション概要](#アプリケーション概要)
2. [基本的な使い方](#基本的な使い方)
3. [詳細設定・パラメータ](#詳細設定パラメータ)
4. [自動生成モード](#自動生成モード)
5. [音楽の保存](#音楽の保存)
6. [トラブルシューティング](#トラブルシューティング)
7. [Tips & コツ](#tips--コツ)

---

## 📱 アプリケーション概要

Momo Song v3は、AI技術を活用した音楽生成Webアプリケーションです。テキストから歌詞、音楽、そして楽曲の世界観を表現した画像を自動生成し、一つの作品として楽しむことができます。

### 🌟 主な機能
- **歌詞自動生成**: テーマやムードから適切な歌詞を作成
- **音楽自動生成**: ACE-Step技術による高品質な楽曲制作
- **画像自動生成**: SDXL技術による楽曲の世界観表現
- **リアルタイム再生**: 生成された音楽の即座の再生
- **自動生成モード**: 無操作時の連続音楽生成
- **エラー回復システム**: 自動生成時の障害対応

---

## 🎯 基本的な使い方

### ステップ1: プロンプト入力
![メイン入力画面](static/megu_song.png)

1. **メインテキストエリア**に生成したい音楽のイメージを入力
   ```
   例: 夏の夕暮れの海辺で聞くような、ノスタルジックなメロディ
   例: アップテンポなロックサウンドで元気が出る曲
   例: 雨の日に家で聞く静かなピアノ曲
   ```

2. **何も入力しない場合**: おまかせで音楽を生成します

### ステップ2: 音楽生成の実行
1. **「音楽生成」ボタン**をクリック
2. 生成プロセスが開始されます：
   - 📝 **作詞・曲データ作成中** → LLMが歌詞とジャンルを決定
   - 🎵 **作詞完了・作曲開始** → 音楽と画像を並行生成
   - ✅ **作曲終了** → 完成した楽曲の再生開始

### ステップ3: 楽曲の鑑賞
- **自動再生**: 生成完了と同時に音楽が再生開始
- **歌詞表示**: 生成された歌詞が画像上にオーバーレイ表示
- **ビジュアライザー**: 音楽に合わせて動的なリングエフェクト
- **楽曲解説**: 作品のテーマやコンセプトを下部に表示

---

## ⚙️ 詳細設定・パラメータ

### 🎨 生成パラメータ（アコーディオンメニュー）

「**生成パラメータ**」セクションを開くと、詳細な設定が可能です：

#### 📝 基本情報設定
| 項目 | 説明 | 例 |
|------|------|-----|
| **タイトル（任意）** | 楽曲のタイトルを事前指定 | `星空の記憶` |
| **ジャンル（任意）** | 音楽ジャンルを指定 | `ポップ、ジャズ、ロック` |
| **ムード（任意）** | 楽曲の雰囲気を指定 | `明るい、落ち着いた、切ない` |
| **楽器（任意）** | 使用楽器を指定 | `ピアノ、ギター、バイオリン` |

#### 🔧 技術パラメータ（スライダー）
| パラメータ | 範囲 | デフォルト | 説明 |
|------------|------|------------|------|
| **infer_step** | 20-200 | 100 | 音楽生成の精度（高いほど高品質、時間増） |
| **guidance_scale** | 1-50 | 15 | プロンプト忠実度（高いほどプロンプト重視） |
| **omega_scale** | 5-50 | 10 | 音楽の複雑さ（高いほど複雑な音楽構成） |
| **音楽の長さ** | -1～180秒 | -1（自動） | 楽曲の長さ指定 |

#### 🖼️ 画像設定
| 設定項目 | オプション | 説明 |
|----------|------------|------|
| **画像サイズ** | 16:9 / 4:3 | アスペクト比の選択 |
| **向き** | 横 / 縦 | 画像の向き（ランドスケープ/ポートレート） |

#### 🎤 音楽設定
| 設定 | 説明 | 効果 |
|------|------|------|
| **ボーカルなしバージョン** | インストゥルメンタル楽曲を生成 | ボーカル除去、BGM用途に最適 |

---

## 🔄 自動生成モード

### 🚀 自動生成の有効化
1. **「自動生成」チェックボックス**をON
2. チェックON後、即座に最初の楽曲生成を開始
3. 以後、60秒間無操作で自動的に新しい楽曲を生成

### 🎵 自動生成の動作
- **連続生成**: 前の楽曲再生終了後、キューが空なら自動生成
- **無操作判定**: キーボード、マウス、タッチ操作で自動停止
- **キューシステム**: 複数楽曲の順次再生に対応

### 🛡️ エラー回復システム
- **自動リトライ**: エラー発生時、10秒後に自動復旧を試行
- **連続エラー保護**: 3回連続エラーで自動生成を停止
- **エラーリセット**: 手動操作時、エラーカウンターをリセット

### 📊 自動生成の停止条件
1. ユーザーによる任意操作（キー入力、クリック等）
2. 手動で自動生成チェックボックスをOFF
3. 3回連続エラー発生時の自動停止
4. ページリロードまたは離脱

---

## 💾 音楽の保存

### 📁 保存機能
**「保存」ボタン**をクリックすると、以下のファイルがダウンロードされます：

1. **歌詞ファイル** (`[タイトル].txt`)
   - 生成された歌詞テキスト
   - UTF-8エンコード

2. **音楽ファイル** (`[タイトル].wav` または `.mp3`)
   - 高品質な音楽データ
   - ブラウザ対応形式

### 💡 保存のベストプラクティス
- お気に入りの楽曲は即座に保存を推奨
- ファイル名は楽曲タイトルに基づいて自動命名
- 複数楽曲を保存する際は、適切なフォルダ整理を推奨

---

## 🔧 基本操作・ボタン

### 🎮 メインコントロール
| ボタン | 機能 | 使用タイミング |
|--------|------|----------------|
| **🎵 音楽生成** | 新しい楽曲の生成開始 | プロンプト入力後 |
| **⬅️ 戻る** | 初期状態にリセット | 新しい楽曲を作りたい時 |
| **💾 保存** | 現在の楽曲をダウンロード | 気に入った楽曲があった時 |

### 🎛️ オーディオコントロール
- **再生/一時停止**: オーディオプレイヤーの標準コントロール
- **音量調整**: ブラウザまたはプレイヤーの音量スライダー
- **シーク**: 楽曲内の任意位置への移動

---

## 🚨 トラブルシューティング

### ❗ よくある問題と解決方法

#### 🔇 音楽が再生されない
**症状**: 生成完了後に音楽が流れない
**解決方法**:
1. ブラウザの自動再生ポリシーを確認
2. オーディオプレイヤーの手動再生ボタンをクリック
3. ブラウザの音量設定を確認
4. 他のタブで音楽が再生されていないか確認

#### 🖼️ 画像が表示されない
**症状**: 音楽は再生されるが画像が生成されない
**解決方法**:
1. 画像生成サーバーの接続を確認
2. デフォルト画像が表示される場合は正常動作
3. ネットワーク接続の安定性を確認

#### ⚠️ 生成エラーが発生する
**症状**: 「作詞・曲データ作成に失敗しました」等のエラー
**解決方法**:
1. プロンプトの内容を変更して再試行
2. 技術パラメータを初期値にリセット
3. ページをリロードして再度実行

#### 🔄 自動生成が停止する
**症状**: 自動生成モードが予期せず停止
**解決方法**:
1. 連続エラー（3回）による自動停止の可能性
2. 「戻る」ボタンでエラー状態をリセット
3. 自動生成チェックボックスを再度有効化

---

## 💡 Tips & コツ

### 🎯 効果的なプロンプト作成
#### ✅ 良いプロンプト例
```
✅ 春の桜が舞う公園で恋人と歩くような、優しくて温かいメロディ
✅ 深夜のドライブで聞きたい、シンセサイザーを使ったクールな楽曲
✅ 雨の日の喫茶店で読書しながら聞くジャズ調の落ち着いた音楽
```

#### ❌ 避けるべきプロンプト
```
❌ いい感じの曲
❌ 普通の音楽
❌ なんでもいい
```

### 🎵 ジャンル別推奨設定

#### 🎸 ロック・ポップス
- **infer_step**: 80-120
- **guidance_scale**: 12-18
- **omega_scale**: 8-12
- **ムード**: "エネルギッシュ", "明るい", "力強い"

#### 🎹 ジャズ・クラシック
- **infer_step**: 100-150
- **guidance_scale**: 15-25
- **omega_scale**: 12-20
- **楽器**: "ピアノ", "サックス", "コントラバス"

#### 🎧 エレクトロニック・アンビエント
- **infer_step**: 60-100
- **guidance_scale**: 10-15
- **omega_scale**: 6-10
- **ジャンル**: "エレクトロニック", "アンビエント", "シンセサイザー"

### 🔄 効率的な楽曲制作ワークフロー
1. **大まかなコンセプト決定** → メインプロンプト入力
2. **詳細パラメータ調整** → ジャンル・ムード指定
3. **初回生成実行** → 結果の評価
4. **パラメータ微調整** → 満足いくまで再生成
5. **お気に入り保存** → 複数バリエーション作成

### 🎨 画像生成のコツ
- **具体的な情景描写**が効果的: "夕暮れの海辺", "雪景色の森"
- **色彩やムード**を含める: "温かい色調", "モノクロ", "幻想的"
- **季節や時間**を指定: "春の午後", "真夜中", "早朝"

### ⚡ パフォーマンス最適化
- **複数タブでの同時実行を避ける**（リソース競合回避）
- **長時間の自動生成時は定期的な確認**を推奨
- **大きなパラメータ値は生成時間が長くなる**ことを考慮

---

## 📞 サポート情報

### 🔧 技術仕様
- **対応ブラウザ**: Chrome, Firefox, Safari, Edge（最新版推奨）
- **推奨環境**: デスクトップ・タブレット（モバイルでも動作）
- **必要な機能**: JavaScript有効、音声再生許可

### 📚 関連ドキュメント
- [技術ドキュメント](DOCUMENTATION.md)
- [API仕様書](API_REFERENCE.md)
- [デプロイガイド](DEPLOYMENT.md)

### 🐛 フィードバック・バグレポート
問題や改善提案がございましたら、GitHub Issuesまでお知らせください。

---

**🎵 Momo Song v3で、あなただけの音楽体験をお楽しみください！**
